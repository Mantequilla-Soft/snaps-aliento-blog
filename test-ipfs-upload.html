<!DOCTYPE html>
<html>
<head>
    <title>3Speak IPFS Supernode Upload Test</title>
</head>
<body>
    <h2>üöÄ 3Speak IPFS Supernode Upload Test</h2>
    
    <div>
        <input type="file" id="fileInput" accept="image/*">
        <button onclick="testIPFSUpload()">Upload to IPFS</button>
    </div>
    
    <div id="results" style="margin-top: 20px; font-family: monospace;"></div>
    
    <script>
        async function testIPFSUpload() {
            const fileInput = document.getElementById('fileInput');
            const results = document.getElementById('results');
            
            if (!fileInput.files[0]) {
                results.innerHTML = '‚ùå Please select a file first';
                return;
            }
            
            const file = fileInput.files[0];
            results.innerHTML = `üì§ Uploading ${file.name} (${(file.size / 1024).toFixed(1)} KB) to 3Speak IPFS...`;
            
            try {
                const formData = new FormData();
                formData.append('file', file);
                
                console.log('üöÄ Starting IPFS upload...');
                const response = await fetch('http://65.21.201.94:5002/api/v0/add', {
                    method: 'POST',
                    body: formData
                });
                
                console.log('üì° Response status:', response.status);
                
                if (!response.ok) {
                    throw new Error(`Upload failed: ${response.status} - ${response.statusText}`);
                }
                
                const responseText = await response.text();
                console.log('üìÑ Raw response:', responseText);
                
                // IPFS returns NDJSON (newline-delimited JSON)
                const lines = responseText.trim().split('\\n');
                const lastLine = lines[lines.length - 1];
                const result = JSON.parse(lastLine);
                
                console.log('‚úÖ Parsed result:', result);
                
                const ipfsHash = result.Hash;
                const ipfsUrl = `https://ipfs.3speak.tv/ipfs/${ipfsHash}`;
                
                results.innerHTML = `
                    <div style="color: green;">‚úÖ Upload successful!</div>
                    <div><strong>IPFS Hash:</strong> ${ipfsHash}</div>
                    <div><strong>IPFS URL:</strong> <a href="${ipfsUrl}" target="_blank">${ipfsUrl}</a></div>
                    <div><strong>File Size:</strong> ${result.Size} bytes</div>
                    <br>
                    <img src="${ipfsUrl}" style="max-width: 300px; border: 1px solid #ccc;" onerror="this.style.display='none'">
                `;
                
            } catch (error) {
                console.error('‚ùå Upload failed:', error);
                results.innerHTML = `
                    <div style="color: red;">‚ùå Upload failed: ${error.message}</div>
                    <div>Check browser console for details</div>
                `;
            }
        }
    </script>
</body>
</html>